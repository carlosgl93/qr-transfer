import{b as o,j as t,ah as k,I as j}from"./deepmerge-CTR-2iFl.js";import{D as w,g as A,d as E}from"./qr-generator-DeMOylU2.js";import{C as T}from"./ContentCopy-pQ2CpILW.js";import{t as q,a as S,B as r,T as a,S as B}from"./App-Cl4K1hj7.js";import{C as u,a as I,b as W,c as N,d as P,q as U,w as G,g as H}from"./firebase-Cjtt-dVy.js";import{f as L,c as F}from"./clipboard-handler-AfVuizbM.js";import{A as m}from"./Alert-CWRSxdOE.js";import"./index-K4Q6e0cW.js";function Y(){const{token:c}=q(),i=S(),[e,g]=o.useState(null),[s,C]=o.useState(""),[b,d]=o.useState(!0),[x,l]=o.useState("");o.useEffect(()=>{if(!c){l("Token inválido"),d(!1);return}(async()=>{try{const n=N(P,"shareableAccounts"),Q=U(n,G("token","==",c)),f=await H(Q);if(f.empty){l("No se encontró una cuenta con este link. Es posible que haya expirado."),d(!1);return}const p=f.docs[0],y={id:p.id,...p.data()};g(y);const D=await A(y);C(D)}catch(n){console.error("Error fetching account:",n),l("Error al cargar la cuenta. Por favor, intenta nuevamente.")}finally{d(!1)}})()},[c]);const v=()=>{s&&e&&(E(s,`qr-${e.fullName.replace(/\s+/g,"-")}.png`),i.show("QR descargado",{severity:"success",autoHideDuration:2e3}))},R=async()=>{if(!e)return;const h=L(e);await F(h)?i.show("Datos copiados al portapapeles",{severity:"success",autoHideDuration:2e3}):i.show("Error al copiar datos",{severity:"error"})};return b?t.jsx(u,{maxWidth:"md",children:t.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:t.jsx(k,{})})}):x||!e?t.jsxs(u,{maxWidth:"md",children:[t.jsx("meta",{name:"title",content:"Link no encontrado"}),t.jsx(r,{sx:{mt:4,mb:4},children:t.jsx(m,{severity:"error",children:x||"Cuenta no encontrada"})})]}):t.jsxs(u,{maxWidth:"md",children:[t.jsx("meta",{name:"title",content:"Tu Código QR"}),t.jsx(r,{sx:{mt:4,mb:4},children:t.jsx(I,{children:t.jsxs(W,{children:[t.jsx(a,{variant:"h4",component:"h1",gutterBottom:!0,align:"center",children:"Tu Código QR"}),t.jsx(m,{severity:"info",sx:{my:3},children:"Guarda este código QR para compartir tus datos bancarios fácilmente."}),t.jsxs(r,{sx:{my:3},children:[t.jsx(a,{variant:"h6",gutterBottom:!0,children:e.fullName}),t.jsxs(a,{variant:"body2",color:"text.secondary",children:["RUT: ",e.rut]}),t.jsxs(a,{variant:"body2",color:"text.secondary",children:[e.bankOrPlatform," - ",e.accountType]}),t.jsxs(a,{variant:"body2",color:"text.secondary",children:["Cuenta: ",e.accountNumber]}),t.jsxs(a,{variant:"body2",color:"text.secondary",children:["Email: ",e.email]})]}),s&&t.jsx(r,{sx:{display:"flex",justifyContent:"center",my:4,p:3,bgcolor:"background.default",borderRadius:2},children:t.jsx("img",{src:s,alt:"QR Code",style:{maxWidth:"100%",height:"auto"}})}),t.jsx(m,{severity:"success",sx:{mb:3},children:"Cuando alguien escanee este código QR, podrá ver tus datos bancarios y copiarlos directamente."}),t.jsxs(B,{spacing:2,children:[t.jsx(j,{variant:"contained",startIcon:t.jsx(w,{}),onClick:v,fullWidth:!0,children:"Descargar QR"}),t.jsx(j,{variant:"outlined",startIcon:t.jsx(T,{}),onClick:R,fullWidth:!0,children:"Copiar Datos"})]})]})})})]})}export{Y as default};
