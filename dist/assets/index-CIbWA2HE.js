import{H as Q,j as t,b as n,J as w,I as h}from"./deepmerge-CTR-2iFl.js";import{t as D,u as A,a as k,L as B,B as u,T as e,S as I}from"./App-Cl4K1hj7.js";import{C as S}from"./ContentCopy-pQ2CpILW.js";import{D as E,g as T,d as H}from"./qr-generator-DeMOylU2.js";import{C as p,a as L,b as N,f as W,d as P,i as U}from"./firebase-Cjtt-dVy.js";import{P as q}from"./ProtectedRoute-DnmPADbU.js";import{u as G}from"./useAuth-D9SyyZ3A.js";import{f as z,c as F}from"./clipboard-handler-AfVuizbM.js";import{A as f}from"./Alert-CWRSxdOE.js";import"./index-K4Q6e0cW.js";const J=Q(t.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack");function M(){const{accountId:c}=D(),{user:i}=G(),d=A(),a=k(),[o,y]=n.useState(null),[r,j]=n.useState(""),[C,g]=n.useState(!0);n.useEffect(()=>{if(!i||!c)return;(async()=>{try{const s=W(P,"users",i.uid,"bankAccounts",c),l=await U(s);if(!l.exists()){a.show("Cuenta no encontrada",{severity:"error"}),d("/dashboard");return}const x={id:l.id,...l.data()};y(x);const R=await T(x);j(R)}catch(s){console.error("Error fetching account:",s),a.show("Error al cargar la cuenta",{severity:"error"})}finally{g(!1)}})()},[i,c,d,a]);const b=()=>{r&&o&&(H(r,`qr-${o.fullName.replace(/\s+/g,"-")}.png`),a.show("QR descargado",{severity:"success",autoHideDuration:2e3}))},v=async()=>{if(!o)return;const m=z(o);await F(m)?a.show("Datos copiados al portapapeles",{severity:"success",autoHideDuration:2e3}):a.show("Error al copiar datos",{severity:"error"})};return C?t.jsx(B,{}):o?t.jsxs(p,{maxWidth:"md",children:[t.jsx("meta",{name:"title",content:"Código QR"}),t.jsxs(u,{sx:{mt:4,mb:4},children:[t.jsx(w,{onClick:()=>d("/dashboard"),sx:{mb:2},children:t.jsx(J,{})}),t.jsx(L,{children:t.jsxs(N,{children:[t.jsx(e,{variant:"h4",component:"h1",gutterBottom:!0,align:"center",children:"Código QR"}),t.jsxs(u,{sx:{my:3},children:[t.jsx(e,{variant:"h6",gutterBottom:!0,children:o.fullName}),t.jsxs(e,{variant:"body2",color:"text.secondary",children:["RUT: ",o.rut]}),t.jsxs(e,{variant:"body2",color:"text.secondary",children:[o.bankOrPlatform," - ",o.accountType]}),t.jsxs(e,{variant:"body2",color:"text.secondary",children:["Cuenta: ",o.accountNumber]})]}),r&&t.jsx(u,{sx:{display:"flex",justifyContent:"center",my:4,p:3,bgcolor:"background.default",borderRadius:2},children:t.jsx("img",{src:r,alt:"QR Code",style:{maxWidth:"100%",height:"auto"}})}),t.jsx(f,{severity:"info",sx:{mb:3},children:"Comparte este código QR. Cuando alguien lo escanee con su app de cámara o lector QR, podrá ver los datos de tu cuenta y copiarlos directamente."}),t.jsxs(I,{spacing:2,children:[t.jsx(h,{variant:"contained",startIcon:t.jsx(E,{}),onClick:b,fullWidth:!0,children:"Descargar QR"}),t.jsx(h,{variant:"outlined",startIcon:t.jsx(S,{}),onClick:v,fullWidth:!0,children:"Copiar Datos"})]})]})})]})]}):t.jsx(p,{maxWidth:"md",children:t.jsx(f,{severity:"error",children:"Cuenta no encontrada"})})}function at(){return t.jsx(q,{children:t.jsx(M,{})})}export{at as default};
