import{b as o,j as t,ag as k,I as j}from"./hooks-BWlgxfag.js";import{D as w,g as A,d as E}from"./qr-generator-CB3jYnl5.js";import{C as T}from"./ContentCopy-BG2QJnER.js";import{z as q,B as r,T as a,S,c as B,d as I,q as W,E as N,g as P}from"./App-BXi3ZNGz.js";import{f as U,c as G}from"./clipboard-handler-AfVuizbM.js";import{C as u,a as H,b as L}from"./Container-DAXyd3cS.js";import{A as m}from"./Alert-C_YSVmH4.js";import{u as z}from"./useNotifications-BpYlB5BH.js";import"./index-Crojux0P.js";import"./NotificationsContext-BH5vbCom.js";function _(){const{token:c}=q(),i=z(),[e,g]=o.useState(null),[s,C]=o.useState(""),[b,d]=o.useState(!0),[x,l]=o.useState("");o.useEffect(()=>{if(!c){l("Token inválido"),d(!1);return}(async()=>{try{const n=B(I,"shareableAccounts"),Q=W(n,N("token","==",c)),f=await P(Q);if(f.empty){l("No se encontró una cuenta con este link. Es posible que haya expirado."),d(!1);return}const p=f.docs[0],y={id:p.id,...p.data()};g(y);const D=await A(y);C(D)}catch(n){console.error("Error fetching account:",n),l("Error al cargar la cuenta. Por favor, intenta nuevamente.")}finally{d(!1)}})()},[c]);const v=()=>{s&&e&&(E(s,`qr-${e.fullName.replace(/\s+/g,"-")}.png`),i.show("QR descargado",{severity:"success",autoHideDuration:2e3}))},R=async()=>{if(!e)return;const h=U(e);await G(h)?i.show("Datos copiados al portapapeles",{severity:"success",autoHideDuration:2e3}):i.show("Error al copiar datos",{severity:"error"})};return b?t.jsx(u,{maxWidth:"md",children:t.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:t.jsx(k,{})})}):x||!e?t.jsxs(u,{maxWidth:"md",children:[t.jsx("meta",{name:"title",content:"Link no encontrado"}),t.jsx(r,{sx:{mt:4,mb:4},children:t.jsx(m,{severity:"error",children:x||"Cuenta no encontrada"})})]}):t.jsxs(u,{maxWidth:"md",children:[t.jsx("meta",{name:"title",content:"Tu Código QR"}),t.jsx(r,{sx:{mt:4,mb:4},children:t.jsx(H,{children:t.jsxs(L,{children:[t.jsx(a,{variant:"h4",component:"h1",gutterBottom:!0,align:"center",children:"Tu Código QR"}),t.jsx(m,{severity:"info",sx:{my:3},children:"Guarda este código QR para compartir tus datos bancarios fácilmente."}),t.jsxs(r,{sx:{my:3},children:[t.jsx(a,{variant:"h6",gutterBottom:!0,children:e.fullName}),t.jsxs(a,{variant:"body2",color:"text.secondary",children:["RUT: ",e.rut]}),t.jsxs(a,{variant:"body2",color:"text.secondary",children:[e.bankOrPlatform," - ",e.accountType]}),t.jsxs(a,{variant:"body2",color:"text.secondary",children:["Cuenta: ",e.accountNumber]}),t.jsxs(a,{variant:"body2",color:"text.secondary",children:["Email: ",e.email]})]}),s&&t.jsx(r,{sx:{display:"flex",justifyContent:"center",my:4,p:3,bgcolor:"background.default",borderRadius:2},children:t.jsx("img",{src:s,alt:"QR Code",style:{maxWidth:"100%",height:"auto"}})}),t.jsx(m,{severity:"success",sx:{mb:3},children:"Cuando alguien escanee este código QR, podrá ver tus datos bancarios y copiarlos directamente."}),t.jsxs(S,{spacing:2,children:[t.jsx(j,{variant:"contained",startIcon:t.jsx(w,{}),onClick:v,fullWidth:!0,children:"Descargar QR"}),t.jsx(j,{variant:"outlined",startIcon:t.jsx(T,{}),onClick:R,fullWidth:!0,children:"Copiar Datos"})]})]})})})]})}export{_ as default};
